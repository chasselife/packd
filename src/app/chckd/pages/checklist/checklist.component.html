<div class="page-wrapper" (click)="onContainerClick($event)">
  <app-page-header>
    <h1 slot="title" class="text-2xl font-semibold font-sans">
      <img class="w-auto h-10" src="chckd.svg" alt="Chckd." />
    </h1>
    <div slot="right-buttons" class="flex items-center gap-2">
      <app-add-button
        label="Add Group"
        icon="folder"
        (add)="openNewChecklistGroupDialog()"
      ></app-add-button>
      <app-menu [menus]="menus" />
    </div>
  </app-page-header>
  @if (isLoading()) {
    <div class="text-center py-12 text-gray-600 flex-1 flex flex-col justify-center">
      Loading checklists...
    </div>
  } @else if (sortedItems().length === 0) {
    <div class="text-center py-16 px-8 text-gray-600 flex-1 flex flex-col justify-center">
      <mat-icon class="text-6xl! w-16! h-16! text-gray-300! mb-4! block! mx-auto!">
        block
      </mat-icon>
      <p class="m-0 text-gray-500">No checklist groups yet</p>
      <a
        class="block mt-2 text-sm text-primary-500 hover:text-primary-600"
        href="#"
        (click)="loadSampleData()"
        >Load sample checklists</a
      >
    </div>
  } @else {
    @if (isSelectMode()) {
      <div class="flex justify-center items-center gap-2 mt-4 mb-2 flex-wrap">
        <button mat-button (click)="deactivateSelectMode()" class="h-9! exit-edit-button">
          <mat-icon>close</mat-icon>
          Exit Mode
        </button>
        <button
          [disabled]="getSelectedCount() <= 0"
          mat-raised-button
          class="h-10!"
          color="warn"
          (click)="deleteSelectedItems()"
        >
          <mat-icon>delete</mat-icon>
          Delete {{ getSelectedCount() > 0 ? getSelectedCount() + ' Item(s)' : '' }}
        </button>
      </div>
      <div class="flex gap-2 justify-center items-center">
        <button mat-button (click)="selectAll()">
          <mat-icon>select_all</mat-icon>
          Select All
        </button>
        <button mat-button (click)="deselectAll()">
          <mat-icon>remove_selection</mat-icon>
          Deselect All
        </button>
      </div>
    } @else if (isEditMode()) {
      <div class="flex justify-center mt-4 mb-2">
        <button mat-button (click)="deactivateEditMode()" class="h-9! exit-edit-button">
          <mat-icon>close</mat-icon>
          Exit Mode
        </button>
      </div>
    } @else {
      <div class="h-4 md:h-6"></div>
    }
    <div
      cdkDropList
      cdkDropListOrientation="mixed"
      (cdkDropListDropped)="onCombinedDrop($event)"
      [cdkDropListDisabled]="!isEditMode() || isSelectMode()"
      class="select-none flex-1 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 px-4 mt-6 md:mt-8 content-start gap-x-4 gap-y-6"
    >
      @for (item of sortedItems(); track item.id) {
        @let isGroup = item.isGroup; @let colorClasses = getColorClasses(item.color);
        @if (isGroup) {
          <app-checklist-tile
            cdkDrag
            [cdkDragDisabled]="!isEditMode() || isSelectMode()"
            [item]="item"
            [isEditMode]="isEditMode()"
            [isSelectMode]="isSelectMode()"
            [isChecklist]="false"
            [colorClasses]="colorClasses"
            [showBorder]="true"
            [showDuplicateButton]="true"
            [defaultIcon]="'folder'"
            [checklistCount]="getGroupChecklistCount(item.id)"
            [isSelected]="isItemSelected(item)"
            (clicked)="onChecklistGroupClick($event)"
            (editClicked)="onGroupEditClick($event.item, $event.event)"
            (deleteClicked)="onGroupDeleteClick($event.item, $event.event)"
            (duplicateClicked)="onGroupDuplicateClick($event.item, $event.event)"
            (selectionChanged)="onSelectionChanged($event)"
            (mouseDown)="onTileMouseDown($event.item, $event.event)"
            (mouseUp)="onTileMouseUp($event)"
            (mouseLeave)="onTileMouseLeave()"
            (touchMove)="onTileTouchMove($event)"
            (touchEnd)="onTileTouchEnd($event.item, $event.event, item.isGroup)"
          />
        } @else {
          <app-checklist-tile
            cdkDrag
            [cdkDragDisabled]="!isEditMode() || isSelectMode()"
            [item]="item"
            [isEditMode]="isEditMode()"
            [isSelectMode]="isSelectMode()"
            [colorClasses]="colorClasses"
            [showDuplicateButton]="true"
            [defaultIcon]="'checklist'"
            [isSelected]="isItemSelected(item)"
            (clicked)="onChecklistClick($event)"
            (editClicked)="onEditClick($event.item, $event.event)"
            (deleteClicked)="onDeleteClick($event.item, $event.event)"
            (duplicateClicked)="onDuplicateClick($event.item, $event.event)"
            (selectionChanged)="onSelectionChanged($event)"
            (mouseDown)="onTileMouseDown($event.item, $event.event)"
            (mouseUp)="onTileMouseUp($event)"
            (mouseLeave)="onTileMouseLeave()"
            (touchMove)="onTileTouchMove($event)"
            (touchEnd)="onTileTouchEnd($event.item, $event.event, item.isGroup)"
          />
        }
      }
    </div>
  }
  <app-footer />
</div>
