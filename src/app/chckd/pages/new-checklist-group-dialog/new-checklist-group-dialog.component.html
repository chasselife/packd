<div class="page-wrapper">
  @let colorData = getSelectedColorClasses();
  <app-form-header
    [colorData]="colorData"
    [title]="isEditMode ? 'Edit Checklist Group' : 'Add Checklist Group'"
  >
    <app-back-button
      slot="left-buttons"
      (back)="goBack()"
      [colorData]="colorData"
    ></app-back-button>
  </app-form-header>

  <div class="flex-1 overflow-y-auto px-4 py-6">
    <form [formGroup]="form" class="flex flex-col w-full">
      <!-- Title Field -->
      <div class="space-y-2">
        <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <mat-icon [class]="'text-base! ' + colorData.textClass">title</mat-icon>
          Group Title
        </label>
        <mat-form-field
          appearance="outline"
          class="w-full"
          [style.--mat-form-field-outlined-focus-outline-color]="colorData.textColorValue"
        >
          <input
            matInput
            formControlName="title"
            placeholder="Enter a descriptive title for your checklist group"
            class="text-base"
          />
          @if (form.get('title')?.hasError('required') && form.get('title')?.touched) {
            <mat-error>Title is required</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Description Field -->
      <div class="space-y-2">
        <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <mat-icon [class]="'text-base! ' + colorData.textClass">description</mat-icon>
          Description
        </label>
        <mat-form-field
          appearance="outline"
          class="w-full"
          [style.--mat-form-field-outlined-focus-outline-color]="colorData.textColorValue"
        >
          <textarea
            matInput
            formControlName="description"
            placeholder="Enter an optional description for your checklist group"
            class="text-base"
            rows="3"
          ></textarea>
        </mat-form-field>
      </div>

      <!-- Icon Field -->
      <div class="space-y-2">
        <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <mat-icon [class]="'text-base! ' + colorData.textClass">palette</mat-icon>
          Icon
        </label>
        <mat-form-field
          appearance="outline"
          class="w-full"
          [style.--mat-form-field-outlined-focus-outline-color]="colorData.textColorValue"
        >
          <mat-select formControlName="icon">
            <mat-select-trigger>
              @if (getSelectedIcon(); as selectedIcon) {
                <div class="flex items-center gap-3 py-1">
                  <mat-icon [class]="colorData.textClass">{{ selectedIcon.value }}</mat-icon>
                  <span class="font-medium">{{ selectedIcon.label }}</span>
                </div>
              }
            </mat-select-trigger>
            @for (icon of icons; track icon.value) {
              <mat-option [value]="icon.value">
                <div class="flex items-center gap-3 py-1">
                  <mat-icon class="text-gray-600">{{ icon.value }}</mat-icon>
                  <span>{{ icon.label }}</span>
                </div>
              </mat-option>
            }
          </mat-select>
          @if (form.get('icon')?.hasError('required') && form.get('icon')?.touched) {
            <mat-error>Icon is required</mat-error>
          }
        </mat-form-field>

        <!-- Color Field -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
            <mat-icon [class]="'text-base! ' + colorData.textClass">color_lens</mat-icon>
            Color Theme
          </label>
          <div class="w-full">
            <app-color-picker [colors]="colorOptions" formControlName="color"></app-color-picker>
            @if (form.get('color')?.hasError('required') && form.get('color')?.touched) {
              <div class="text-xs text-red-600 mt-1 ml-1">Color is required</div>
            }
          </div>
        </div>
      </div>

      <!-- Preview Section -->
      @if (form.get('title')?.value || form.get('icon')?.value || form.get('color')?.value) {
        <div class="p-4 rounded-xl border-2 border-dashed border-gray-200 bg-gray-50">
          <p class="text-xs font-semibold text-gray-500 uppercase mb-4">Preview</p>
          @let colorClasses = getSelectedColor();
          @let defaultColorClasses =
            {
              bgClass: 'bg-primary-500/20',
              borderClass: 'border-primary',
              textClass: 'text-primary!',
            };
          @let previewColorClasses = colorClasses || defaultColorClasses;
          <div class="w-40">
            <app-checklist-tile
              [item]="getPreviewGroup()"
              [isEditMode]="false"
              [isChecklist]="false"
              [colorClasses]="previewColorClasses"
              [showBorder]="true"
              [defaultIcon]="'folder'"
            />
          </div>
        </div>
      }
    </form>
  </div>

  <div class="-ml-6 -mr-6 mt-6 px-10 pt-4 pb-6 bg-gray-50 border-t border-gray-200 rounded-b-lg">
    <div class="flex items-center gap-3 w-full justify-end">
      <button
        mat-button
        (click)="goBack()"
        class="px-6 py-2 font-medium text-gray-600 hover:bg-gray-100"
      >
        <mat-icon class="text-lg">close</mat-icon>
        <span>Cancel</span>
      </button>
      <button
        mat-raised-button
        (click)="isEditMode ? onSave() : onCreate()"
        [disabled]="!form.valid"
        [style.background-color]="colorData.textColorValue"
        [style.color]="'white'"
        class="px-6 py-2 font-semibold shadow-md hover:shadow-lg transition-shadow"
      >
        <mat-icon class="text-lg">{{ isEditMode ? 'save' : 'add_circle' }}</mat-icon>
        <span>{{ isEditMode ? 'Save Changes' : 'Create Group' }}</span>
      </button>
    </div>
  </div>
</div>
