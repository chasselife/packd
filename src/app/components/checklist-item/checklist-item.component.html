<div class="max-w-6xl mx-auto p-8 md:p-4">
  <div class="mb-4 flex items-center gap-2">
    <button
      (click)="goBack()"
      class="p-2 rounded-lg hover:bg-gray-100 transition-colors cursor-pointer"
      aria-label="Go back"
    >
      <mat-icon class="text-2xl!">arrow_back</mat-icon>
    </button>
    <h1
      class="text-2xl md:text-3xl font-semibold text-gray-800 font-sans flex gap-4 items-center flex-1"
    >
      @if (checklist()) { @if (checklist()!.icon) {
      <mat-icon class="text-5xl w-12 h-12">{{ checklist()!.icon }}</mat-icon>
      }
      {{ checklist()!.title }}
      }
    </h1>
    <button mat-raised-button color="primary" (click)="openNewItemDialog()" class="ml-auto">
      <mat-icon>add</mat-icon>
      Add <span class="hidden sm:inline"> Item</span>
    </button>
  </div>

  @if (!isLoading() && checklistItems().length > 0) {
  <div class="mb-6 flex justify-end gap-2">
    <button
      mat-icon-button
      [class.bg-gray-100!]="layoutMode() === 'compact'"
      [class.opacity-50]="layoutMode() !== 'compact'"
      (click)="setLayoutMode('compact')"
      aria-label="Compact view"
      title="Compact view"
    >
      <mat-icon>view_stream</mat-icon>
    </button>
    <button
      mat-icon-button
      [class.bg-gray-100!]="layoutMode() === 'full'"
      [class.opacity-50]="layoutMode() !== 'full'"
      (click)="setLayoutMode('full')"
      aria-label="Full view"
      title="Full view"
    >
      <mat-icon>view_agenda</mat-icon>
    </button>
  </div>
  } @if (isLoading()) {
  <div class="text-center py-12 text-gray-600 text-lg">Loading items...</div>
  } @else if (checklistItems().length === 0) {
  <div class="text-center py-16 px-8 text-gray-600">
    <mat-icon class="text-6xl w-16 h-16 text-gray-300 mb-4 block mx-auto"> checklist </mat-icon>
    <p class="text-lg m-0">No items in this checklist yet.</p>
  </div>
  } @else {
  <div
    cdkDropList
    (cdkDropListDropped)="onItemDrop($event)"
    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3"
    [class.gap-4]="layoutMode() === 'full'"
    [class.gap-2]="layoutMode() !== 'full'"
  >
    @for (item of checklistItems(); track item.id) {
    <div
      cdkDrag
      class="flex justify-between items-center border transition-colors duration-300 relative backdrop-blur-sm cursor-move"
      [class.p-4]="layoutMode() === 'full'"
      [class.p-3]="layoutMode() === 'compact'"
      [class.rounded-xl]="layoutMode() === 'full'"
      [class.rounded-lg]="layoutMode() !== 'full'"
      [class.bg-white]="!item.isDone"
      [class.bg-emerald-50]="item.isDone"
      [class.border-gray-300]="!item.isDone"
      [class.border-emerald-500]="item.isDone"
    >
      <div class="flex-1 flex items-center gap-3">
        <div
          class="shrink-0 cursor-pointer"
          (click)="toggleItemDone(item)"
          (mousedown)="$event.stopPropagation()"
        >
          @if (item.isDone) {
          <mat-icon class="text-3xl text-emerald-600!">check_circle</mat-icon>
          } @else {
          <mat-icon class="text-3xl text-gray-400">radio_button_unchecked</mat-icon>
          }
        </div>
        <div class="flex-1 min-w-0 cursor-pointer" (click)="toggleItemDone(item)">
          <h3
            class="font-medium mb-1 flex gap-1 items-center"
            [class.text-lg]="layoutMode() === 'full'"
            [class.text-base]="layoutMode() === 'compact'"
            [class.text-gray-800]="!item.isDone"
            [class.text-emerald-800]="item.isDone"
            [class.line-through]="item.isDone"
          >
            @if (item.icon) {
            <mat-icon class="align-middle mr-1 text-xl">{{ item.icon }}</mat-icon>
            }
            {{ item.title }}
          </h3>
          @if (item.description && layoutMode() === 'full') {
          <p
            class="text-sm m-0 whitespace-pre-wrap"
            [class.text-gray-600]="!item.isDone"
            [class.text-emerald-700]="item.isDone"
          >
            {{ item.description }}
          </p>
          }
        </div>
      </div>
      @if (layoutMode() === 'full') {
      <div class="flex gap-1">
        <button
          mat-icon-button
          color="primary"
          (click)="openEditItemDialog(item); $event.stopPropagation()"
          aria-label="Edit item"
        >
          <mat-icon>edit</mat-icon>
        </button>
        <button
          mat-icon-button
          color="warn"
          (click)="deleteItem(item); $event.stopPropagation()"
          aria-label="Delete item"
        >
          <mat-icon>delete</mat-icon>
        </button>
      </div>
      }
    </div>
    }
  </div>
  }
</div>
