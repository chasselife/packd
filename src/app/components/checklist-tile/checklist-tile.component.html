<div
  [class]="
    'w-full transition-all duration-300 flex flex-col items-center justify-center relative backdrop-blur-sm ' +
    (isChecklist()
      ? 'rounded-2xl p-6 shadow-lg hover:shadow-xl border-2 checklist-tile'
      : 'rounded-t-2xl rounded-b-xl p-6 pt-8 shadow-xl hover:shadow-2xl border-2 group-tile') +
    ' ' +
    colorClasses().bgClass +
    ' ' +
    colorClasses().borderClass +
    ' ' +
    colorClasses().textClass
  "
  [class.border-2]="showBorder()"
  [class.no-hover]="isEditMode()"
  [class.wiggle-animation]="isEditMode()"
  [class.cursor-pointer]="!isEditMode()"
  [class.cursor-move]="isEditMode()"
  [style.touch-action]="isEditMode() ? 'none' : 'auto'"
  (click)="onTileClick()"
  (mousedown)="onMouseDown($event)"
  (mouseup)="onMouseUp($event)"
  (mouseleave)="onMouseLeave()"
  (touchstart)="onMouseDown($event)"
  (touchmove)="onTouchMove($event)"
  (touchend)="onTouchEnd($event)"
  (touchcancel)="onMouseLeave()"
>
  @if (!isChecklist()) {
  <!-- Folder tab for groups -->
  <div
    class="absolute -top-[7px] left-[2px] w-[calc(100%-.25rem)] h-2 rounded-t-2xl z-10"
    [class]="colorClasses().bgClass + ' ' + colorClasses().borderClass"
    [style.border-width]="'2px 2px 0 2px'"
  ></div>
  } @if (isEditMode()) {
  <!-- Drag handle - top left corner -->
  <div class="absolute top-2 left-2 text-gray-400 cursor-move z-10">
    <mat-icon class="text-2xl!" [style.color]="itemColor || undefined">drag_indicator</mat-icon>
  </div>
  <!-- Delete button - top right corner with red circular background -->
  <button
    mat-icon-button
    color="danger"
    class="absolute! w-8! h-8! -top-3 -right-3 bg-red-500! rounded-full flex! items-center justify-center text-white! hover:bg-red-600! transition-colors z-20!"
    (click)="onDeleteClick($event)"
    [attr.aria-label]="isChecklist() ? 'Delete checklist' : 'Delete group'"
  >
    <mat-icon class="text-lg!">close</mat-icon>
  </button>
  }

  <div [class]="isChecklist() ? 'md:mb-1' : 'md:mb-2 relative z-10'">
    <mat-icon
      [class]="
        isChecklist()
          ? 'text-3xl! w-8! flex h-8! md:text-4xl! md:w-10! md:h-10!'
          : 'text-4xl! w-10! flex h-10! md:text-5xl! md:w-12! md:h-12!'
      "
    >
      {{ itemIcon }}
    </mat-icon>
    @if (isChecklist() && !isEditMode()) {
    <!-- Subtle checkmark accent for checklist tiles -->
    <div
      class="absolute -top-1 -right-1 w-5 h-5 rounded-full flex items-center justify-center opacity-60"
      [class]="colorClasses().bgClass"
    >
      <mat-icon class="text-xs! text-white!">check</mat-icon>
    </div>
    }
  </div>
  <div
    [class]="
      isChecklist()
        ? 'text-sm sm:text-lg font-medium text-center wrap-break-word'
        : 'text-sm sm:text-lg font-semibold text-center wrap-break-word'
    "
  >
    {{ itemTitle }}
  </div>
  @if (!isEditMode() && !isChecklist() && checklistCount() !== undefined && checklistCount()! > 0) {
  <div class="bg-white/50 rounded-lg text-sm mt-3 px-2 py-1">
    {{ checklistCount() }} checklist{{ checklistCount()! > 1 ? 's' : '' }}
  </div>
  }
  <div class="flex-1"></div>

  @if (isEditMode()) {
  <div class="flex flex-row gap-3 mt-4 max-w-[calc(100%+2.5rem)]">
    <!-- Edit button -->
    <button
      mat-mini-fab
      class="shadow-none! bg-white/50! flex content-center text-sm! md:text-base!"
      (click)="onEditClick($event)"
      [class]="
        colorClasses().bgClass + ' ' + colorClasses().borderClass + ' ' + colorClasses().textClass
      "
      [style.color]="itemColor || undefined"
      [attr.aria-label]="isChecklist() ? 'Edit checklist' : 'Edit group'"
    >
      <mat-icon>edit</mat-icon>
    </button>
    <!-- Duplicate button -->
    @if (showDuplicateButton()) {
    <button
      mat-mini-fab
      class="shadow-none! bg-white/50! flex content-center text-sm! md:text-base!"
      (click)="onDuplicateClick($event)"
      [class]="
        colorClasses().bgClass + ' ' + colorClasses().borderClass + ' ' + colorClasses().textClass
      "
      [style.color]="itemColor || undefined"
      [attr.aria-label]="isChecklist() ? 'Duplicate checklist' : 'Duplicate group'"
    >
      <mat-icon>content_copy</mat-icon>
    </button>
    }
  </div>
  }
</div>
