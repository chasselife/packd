<div
  [class]="
    'w-full transition-all duration-300 relative backdrop-blur-sm ' +
    (layout() === 'horizontal'
      ? 'flex flex-row items-center justify-start gap-3 '
      : 'flex flex-col items-center justify-center ') +
    (layout() === 'horizontal'
      ? isChecklist()
        ? 'rounded-lg px-4 py-3 shadow-md hover:shadow-lg border-none checklist-tile'
        : 'rounded-lg px-4 py-3 shadow-md hover:shadow-lg border-none group-tile'
      : isChecklist()
      ? 'rounded-2xl p-6 shadow-lg hover:shadow-xl border-none checklist-tile'
      : 'rounded-t-2xl rounded-b-xl p-6 pt-8 shadow-xl hover:shadow-2xl border-none group-tile') +
    ' ' +
    colorClasses().bgClass +
    ' ' +
    colorClasses().borderClass +
    ' ' +
    colorClasses().textClass
  "
  [class.border]="showBorder()"
  [class.no-hover]="isEditMode() || isSelectMode()"
  [class.wiggle-animation]="isEditMode()"
  [class.cursor-pointer]="!isEditMode() && !isSelectMode()"
  [class.cursor-move]="isEditMode()"
  [style.touch-action]="isEditMode() || isSelectMode() ? 'none' : 'auto'"
  (click)="onTileClick()"
  (mousedown)="onMouseDown($event)"
  (mouseup)="onMouseUp($event)"
  (mouseleave)="onMouseLeave()"
  (touchstart)="onMouseDown($event)"
  (touchmove)="onTouchMove($event)"
  (touchend)="onTouchEnd($event)"
  (touchcancel)="onMouseLeave()"
>
  @if (!isChecklist() && layout() === 'vertical') {
  <!-- Folder tab for groups (only in vertical layout) -->
  <div
    class="absolute -top-[7px] left-2 w-12 h-2 rounded-t-2xl z-10"
    [class]="colorClasses().bgClass + ' ' + colorClasses().borderClass"
    [style.border-width]="'0px 0px 0 0px'"
  ></div>
  } @if (isSelectMode()) {
  <!-- Checkbox - top left corner in select mode -->
  <div
    [class]="
      layout() === 'horizontal' ? 'absolute top-1 left-1 z-30' : 'absolute top-2 left-2 z-30'
    "
  >
    <mat-checkbox
      [checked]="isSelected()"
      (change)="onSelectionChange($event.checked)"
      (click)="$event.stopPropagation()"
      [class]="layout() === 'horizontal' ? 'scale-75' : ''"
      color="primary"
      [style.--mdc-checkbox-selected-hover-state-layer-color]="itemColor"
      [style.--mdc-checkbox-selected-pressed-state-layer-color]="itemColor"
      [style.--mdc-checkbox-selected-icon-color]="itemColor"
      [style.--mat-checkbox-selected-icon-color]="itemColor"
    ></mat-checkbox>
  </div>
  } @if (isEditMode()) {
  <!-- Drag handle - top left corner in edit mode -->
  <div
    [class]="
      layout() === 'horizontal'
        ? 'absolute top-1 left-1 text-gray-400 cursor-move z-10'
        : 'absolute top-2 left-2 text-gray-400 cursor-move z-10'
    "
  >
    <mat-icon
      [class]="layout() === 'horizontal' ? 'text-xl!' : 'text-2xl!'"
      [style.color]="itemColor || undefined"
      >drag_indicator</mat-icon
    >
  </div>
  <!-- Delete button - top right corner with red circular background -->
  <button
    mat-icon-button
    color="danger"
    [class]="
      layout() === 'horizontal'
        ? 'absolute! w-6! h-6! -top-2 -right-2 bg-red-500! rounded-full flex! items-center justify-center text-white! hover:bg-red-600! transition-colors z-20!'
        : 'absolute! w-8! h-8! -top-3 -right-3 bg-red-500! rounded-full flex! items-center justify-center text-white! hover:bg-red-600! transition-colors z-20!'
    "
    (click)="onDeleteClick($event)"
    [attr.aria-label]="isChecklist() ? 'Delete checklist' : 'Delete group'"
  >
    <mat-icon [class]="layout() === 'horizontal' ? 'text-sm!' : 'text-lg!'">close</mat-icon>
  </button>
  }

  <div
    [class]="
      layout() === 'horizontal'
        ? 'shrink-0 relative z-10'
        : isChecklist()
        ? 'md:mb-1'
        : 'md:mb-2 relative z-10'
    "
  >
    <mat-icon
      [class]="
        layout() === 'horizontal'
          ? isChecklist()
            ? 'text-2xl! w-6! flex h-6! md:text-3xl! md:w-8! md:h-8!'
            : 'text-3xl! w-8! flex h-8! md:text-4xl! md:w-10! md:h-10!'
          : isChecklist()
          ? 'text-3xl! w-8! flex h-8! md:text-4xl! md:w-10! md:h-10!'
          : 'text-4xl! w-10! flex h-10! md:text-5xl! md:w-12! md:h-12!'
      "
    >
      {{ itemIcon }}
    </mat-icon>
  </div>
  <div
    [class]="
      layout() === 'horizontal'
        ? isChecklist()
          ? 'text-sm sm:text-base font-medium wrap-break-word flex-1 min-w-0'
          : 'text-sm sm:text-base font-semibold wrap-break-word flex-1 min-w-0'
        : isChecklist()
        ? 'text-sm sm:text-lg font-medium text-center wrap-break-word'
        : 'text-sm sm:text-lg font-semibold text-center wrap-break-word'
    "
  >
    {{ itemTitle }}
  </div>
  @if (!isEditMode() && !isChecklist() && checklistCount() !== undefined && checklistCount()! > 0) {
  <div
    [class]="
      layout() === 'horizontal'
        ? 'bg-white/50 rounded-lg text-xs sm:text-sm px-2 py-1 shrink-0'
        : 'bg-white/50 rounded-lg text-sm mt-3 px-2 py-1'
    "
  >
    {{ checklistCount() }} checklist{{ checklistCount()! > 1 ? 's' : '' }}
  </div>
  } @if (layout() === 'vertical') {
  <div class="flex-1"></div>
  } @if (isEditMode()) {
  <div
    [class]="
      layout() === 'horizontal'
        ? 'flex flex-row gap-2 ml-auto shrink-0'
        : 'flex flex-row gap-3 mt-4 max-w-[calc(100%+2.5rem)]'
    "
  >
    <!-- Edit button -->
    <button
      mat-mini-fab
      class="shadow-none! bg-white/50! flex content-center text-sm! md:text-base!"
      (click)="onEditClick($event)"
      [class]="
        colorClasses().bgClass + ' ' + colorClasses().borderClass + ' ' + colorClasses().textClass
      "
      [style.color]="itemColor || undefined"
      [attr.aria-label]="isChecklist() ? 'Edit checklist' : 'Edit group'"
    >
      <mat-icon>edit</mat-icon>
    </button>
    <!-- Duplicate button -->
    @if (showDuplicateButton()) {
    <button
      mat-mini-fab
      class="shadow-none! bg-white/50! flex content-center text-sm! md:text-base!"
      (click)="onDuplicateClick($event)"
      [class]="
        colorClasses().bgClass + ' ' + colorClasses().borderClass + ' ' + colorClasses().textClass
      "
      [style.color]="itemColor || undefined"
      [attr.aria-label]="isChecklist() ? 'Duplicate checklist' : 'Duplicate group'"
    >
      <mat-icon>content_copy</mat-icon>
    </button>
    }
  </div>
  }
</div>
